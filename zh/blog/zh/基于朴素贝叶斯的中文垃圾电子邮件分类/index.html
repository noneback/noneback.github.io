<!DOCTYPE html>
<html lang="zh"><head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>基于朴素贝叶斯的中文垃圾电子邮件分类</title>
    <meta charset="utf-8">
    <meta name="description" content="Ladder@基于朴素贝叶斯的中文垃圾电子邮件分类 训练数据和测试数据 本次主要使用了github上的开源数据 数据处理 首先使用正则表达式对训练集中的中文邮件的">
    <meta name="author" content="NoneBack">
    <link rel="canonical" href="https://noneback.github.io/zh/blog/zh/%E5%9F%BA%E4%BA%8E%E6%9C%B4%E7%B4%A0%E8%B4%9D%E5%8F%B6%E6%96%AF%E7%9A%84%E4%B8%AD%E6%96%87%E5%9E%83%E5%9C%BE%E7%94%B5%E5%AD%90%E9%82%AE%E4%BB%B6%E5%88%86%E7%B1%BB/">
        <meta name="google-site-verification" content="xxx">

    <link rel="alternate" type="application/rss+xml" href="https://noneback.github.io//index.xml" title="NoneBack">

    
<script async src="https://www.googletagmanager.com/gtag/js?id=G-H0SRTJWPEK"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-H0SRTJWPEK', { 'anonymize_ip': false });
}
</script>



<script async defer data-website-id="43dc9e5a-7ab8-482e-94df-100975b5d2c8" src="https://umami-blog-pi.vercel.app/noneback-blog"></script>

    <meta property="og:title" content="基于朴素贝叶斯的中文垃圾电子邮件分类" />
<meta property="og:description" content="基于朴素贝叶斯的中文垃圾电子邮件分类 训练数据和测试数据 本次主要使用了github上的开源数据 数据处理 首先使用正则表达式对训练集中的中文邮件的" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://noneback.github.io/zh/blog/zh/%E5%9F%BA%E4%BA%8E%E6%9C%B4%E7%B4%A0%E8%B4%9D%E5%8F%B6%E6%96%AF%E7%9A%84%E4%B8%AD%E6%96%87%E5%9E%83%E5%9C%BE%E7%94%B5%E5%AD%90%E9%82%AE%E4%BB%B6%E5%88%86%E7%B1%BB/" /><meta property="article:section" content="blog" />
<meta property="article:published_time" content="2020-05-06T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-05-06T00:00:00+00:00" />


<meta name="twitter:card" content="summary"/><meta name="twitter:title" content="基于朴素贝叶斯的中文垃圾电子邮件分类"/>
<meta name="twitter:description" content="基于朴素贝叶斯的中文垃圾电子邮件分类 训练数据和测试数据 本次主要使用了github上的开源数据 数据处理 首先使用正则表达式对训练集中的中文邮件的"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Blogs",
      "item": "https://noneback.github.io/zh/blog/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "基于朴素贝叶斯的中文垃圾电子邮件分类",
      "item": "https://noneback.github.io/zh/blog/zh/%E5%9F%BA%E4%BA%8E%E6%9C%B4%E7%B4%A0%E8%B4%9D%E5%8F%B6%E6%96%AF%E7%9A%84%E4%B8%AD%E6%96%87%E5%9E%83%E5%9C%BE%E7%94%B5%E5%AD%90%E9%82%AE%E4%BB%B6%E5%88%86%E7%B1%BB/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "基于朴素贝叶斯的中文垃圾电子邮件分类",
  "name": "基于朴素贝叶斯的中文垃圾电子邮件分类",
  "description": "基于朴素贝叶斯的中文垃圾电子邮件分类 训练数据和测试数据 本次主要使用了github上的开源数据 数据处理 首先使用正则表达式对训练集中的中文邮件的",
  "keywords": [
    "ML"
  ],
  "articleBody": "基于朴素贝叶斯的中文垃圾电子邮件分类 训练数据和测试数据 本次主要使用了github上的开源数据\n数据处理 首先使用正则表达式对训练集中的中文邮件的内容进行过滤，去除其中中文之外的其他字符，再将剩下的内容使用jieba进行分词，过滤掉中文停用字表中的内容。将垃圾邮件以及正常邮件的处理结果分别存放。\n用两个字典spam_voca和normal_voca用于保存不同邮件中不同词语的词频，数据处理完成。\n训练与预测 训练和预测的过程主要使计算$ P(Spam|word_1,word_2,…,word_n) $的概率，当这个概率大于某个阈值的时候，这个邮件被分类为垃圾邮件。\n根据朴素贝叶斯的条件独立假设，并设先验概率$P(s)=P(s^{’})=0.5$,则有： P(s|w_1,w_2,…,w_n)=$\\frac {P(s,w_1,w_2,…,w_n)}{P(w_1,w_2,…,w_n)}$\n=$\\frac {P(w_1,w_2,…,w_n|s)P(s)}{P(w_1,w_2,…,w_n)}$=$\\frac {P(w_1,w_2,…,w_n|s)P(s)}{P(w_1,w_2,…,w_n|s)\\cdot p(s)+P(w_1,w_2,…,w_n|s^{’})\\cdot p(s^{’})}\\qquad\\qquad$\n因为P(spam)=P(not spam),则有\n$\\frac {\\prod\\limits_{j=1}^nP(w_j|s)}{\\prod\\limits_{j=1}^nP(w_j|s)+\\prod\\limits_{j=1}^nP(w_j|s^{’})}$ 再利用贝叶斯$P(w_j|s)=\\frac{P(s|w_j)\\cdot P(w_j)}{P(s)}$,式子化为 $\\frac {\\prod\\limits_{j=1}^nP(s|w_j)}{\\prod\\limits_{j=1}^nP(s|w_j)+\\prod\\limits_{j=1}^nP(s^{’}|w_j)}$\n具体流程\n对测试集中的每一封邮件做同样的处理，并计算得到$P(s|w)$最高的n个词，在计算过程中，若该词只出现在垃圾邮件的词典中，则令$P(w|s^{’})=0.01$，反之亦然；若都未出现，则令$P(s|w)=0.4$。PS.这里做的几个假设基于前人做的一些研究工作得出的。 对得到的每封邮件中重要的15个词利用式2计算概率，若概率$\u003e$阈值$\\alpha(一般设为0.9)$，则判为垃圾邮件，否则判为正常邮件。 具体的代码细节可以参见附加的代码。\n结果 通过调整预测是使用的词汇的数量，针对本次数据集，最佳的结果是\n选择29个词汇 : 0.9642857142857143 附加 项目结构 ├── data │ ├── 中文停用词表.txt │ ├── normal │ ├── spam │ └── test ├── main.py ├── normal_voca.json ├── pycache │ └── utils.cpython-36.pyc ├── spam_voca.json └── utils.py\n具体代码\n# utils.py import jieba import numpy import re import os import json from collections import defaultdict spam_file_num=7775 normal_file_num=7063 #todo 原始邮件数据的预处理 ''' 获取中文的停用词表 【停用词】（https://zh.wikipedia.org/wiki/%E5%81%9C%E7%94%A8%E8%AF%8D） ''' def get_stopwords(): return [ i.strip() for i in open('./data/中文停用词表.txt', encoding='gbk') ] ''' 读取原始文件，进行简单的处理和分词，返回分词列表 ''' def get_raw_str_list(path): stop_list = get_stopwords() with open(path, encoding='gbk') as f: raw_str = f.read() pattern = '[^\\u4E00-\\u9FA5]' #中文的unicode编码的范围 regex = re.compile(pattern) ret = regex.findall(raw_str) handled_str = re.sub(pattern, '', raw_str) str_list = [ word for word in jieba.cut(handled_str) if word not in stop_list ] return str_list #分词以及统计词频，得到词汇表 ''' 返回一个字典，记录了分词后的词汇表 path:k可以使dir或者file路径，默认为存放文本的dir is_file_path:表示输入路径是不是文件 ''' def get_voca(path, is_file_path=False): if is_file_path: return read_voca_from_file(path) voca = defaultdict(int) # 获取垃圾邮件列表 file_list = [file for file in os.listdir(path)] #获得词汇表 for file in file_list: #测试用 raw_str_list = get_raw_str_list(path + str(file)) for raw_str in raw_str_list: voca[raw_str] = voca[raw_str] + 1 return voca ''' 将得到的词汇表保存到json文件中，以便下次读取 voca:词汇表字典 path:文件的保存路径 sort_by_value:是否按value值排序 ''' def save_voca2json(voca, path, sort_by_value=False,indent_=4): if sort_by_value: sorted_by_value(voca) with open(path, 'w+') as f: f.write(json.dumps(voca, ensure_ascii=False, indent=indent_)) ''' 从json文件中读取voca ''' def read_voca_from_file(path): voca = None with open(path) as f: voca = json.load(f) return voca ''' 将字典基于value排序 ''' def sorted_by_value(_dict): _dict = dict(sorted(spam_voca.items(), key=lambda x: x[1], reverse=True)) #计算 P(Spam|word) ''' 计算邮件和邮件分类最相关词语及其 P(spam|word) words_size:最终使用词语的数量，用于最后的预测 ''' def get_top_words_prob(path,spam_voca,normal_voca,words_size=30): critical_words=[] for word in get_raw_str_list(path): if word in spam_voca.keys() and word in normal_voca.keys(): # 如果word在两边都出现 p_w_s=spam_voca[word]/spam_file_num p_w_n=normal_voca[word]/normal_file_num p_s_w=p_w_s/(p_w_n+p_w_s) elif word in spam_voca.keys() and word not in normal_voca.keys(): # 如果word只在spam出现 p_w_s=spam_voca[word]/spam_file_num p_w_n=0.01 p_s_w=p_w_s/(p_w_n+p_w_s) elif word not in spam_voca.keys() and word in normal_voca.keys(): # 如果word只在normal出现 p_w_s=0.01 p_w_n=normal_voca[word]/normal_file_num p_s_w=p_w_s/(p_w_n+p_w_s) else: #如果都不出现 p_s_w=0.4 #以上设定的数值均是基于前人的研究得到的数据 critical_words.append([word,p_s_w]) return dict(sorted(critical_words[:words_size],key=lambda x:x[1],reverse=True)) ''' 计算贝叶斯概率 words_prob：包含词汇以及其P(spam|word)概率的一个字典 spam_voca:垃圾邮件词汇表 normal_voca:正常邮件词汇表 ''' def caculate_bayes(words_prob,spam_voca,normal_voca): p_s_w=1 p_s_nw=1 for word,prob in words_prob.items(): p_s_w*=prob p_s_nw*=(1-prob) return p_s_w/(p_s_w+p_s_nw) def predict(bayes,threshold=0.9): return bayes\u003e=threshold ''' 返回文件名和label ''' def get_files_labels(dir_path,is_spam=True): raw_files_list=os.listdir(dir_path) files_list= [dir_path+file for file in raw_files_list] labels=[is_spam for i in range(len(files_list))] return files_list,labels ''' 预测测试集结果并打印 file_list：测试集文件路径集合 y:测试集结果标签 word_size：预测的指标 ''' def predict_result(file_list,y,spam_voca,normal_voca,word_size=30): ret=[] right=0 for file in file_list: # raw_strs=get_raw_str_list(str(file)) words_prob=get_top_words_prob(file,spam_voca,normal_voca,words_size=word_size) bayes=caculate_bayes(words_prob,spam_voca,normal_voca) ret.append(predict(bayes)) for i in range(len(ret)): if ret[i]==y[i]: right+=1 print(right/len(y)) #main.py from utils import * if __name__=='__main__': #获取词典并保存，一遍下次读取 spam_voca=get_voca('./spam_voca.json',is_file_path=True) normal_voca=get_voca('./normal_voca.json',is_file_path=True) #保存方便下次读取 save_voca2json(spam_voca,'./spam_voca.json') save_voca2json(normal_voca,'./snormal_voca.json') #预处理测试数据 s_x,s_y=get_files_labels('./data/test/spam/') n_x,n_y=get_files_labels('./data/test/normal/',is_spam=False) x,y=list(s_x+n_x),s_y+n_y #预测结果 for i in range(10,40): print(str(i)+' : ',end='') predict_result(x,y,spam_voca,normal_voca,word_size=i) 源码 github\n",
  "wordCount" : "1684",
  "inLanguage": "zh",
  "datePublished": "2020-05-06T00:00:00Z",
  "dateModified": "2020-05-06T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "NoneBack"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://noneback.github.io/zh/blog/zh/%E5%9F%BA%E4%BA%8E%E6%9C%B4%E7%B4%A0%E8%B4%9D%E5%8F%B6%E6%96%AF%E7%9A%84%E4%B8%AD%E6%96%87%E5%9E%83%E5%9C%BE%E7%94%B5%E5%AD%90%E9%82%AE%E4%BB%B6%E5%88%86%E7%B1%BB/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "NoneBack",
    "logo": {
      "@type": "ImageObject",
      "url": "https://noneback.github.io/favicon.ico"
    }
  }
}
</script>
    <link rel="icon" href="/images/avatar.jpeg" sizes="16x16">

<link rel="apple-touch-icon" href="/images/avatar.jpeg">

<link rel="manifest" href="/images/avatar.jpeg">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css"
    integrity="sha384-R4558gYOUz8mP9YWpZJjofhk+zx0AS11p36HnD2ZKj/6JR5z27gSSULCNHIRReVs" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"
    integrity="sha384-z1fJDqw8ZApjGO3/unPWUPsIymfsJmyrDVWC8Tv/a1HeOtGmkwNd/7xUS0Xcnvsx"
    crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js"
    integrity="sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR"
    crossorigin="anonymous"></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        renderMathInElement(document.body, {
            
            
            delimiters: [
                { left: '$$', right: '$$', display: true },
                { left: '$', right: '$', display: false },
                { left: '\\(', right: '\\)', display: false },
                { left: '\\[', right: '\\]', display: true },
                { left: "\\begin{equation}", right: "\\end{equation}", display: true },
                { left: "\\begin{align}", right: "\\end{align}", display: true },
                { left: "\\begin{alignat}", right: "\\end{alignat}", display: true },
                { left: "\\begin{gather}", right: "\\end{gather}", display: true },
                { left: "\\begin{CD}", right: "\\end{CD}", display: true },
                { left: "\\[", right: "\\]", display: true }
            ],
            
            throwOnError: false,
            trust: (context) => ['\\htmlId', '\\href'].includes(context.command),
            macros: {
                "\\eqref": "\\href{###1}{(\\text{#1})}",
                "\\ref": "\\href{###1}{\\text{#1}}",
                "\\label": "\\htmlId{#1}{}"
            }
        });
    });
</script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lxgw-wenkai-webfont@1.7.0/style.css" />

    
    
    <link rel="stylesheet" href="/css/main.min.ec28f09e946fc0df77c187fcd0d0ebde58fca6de8efb8e1620f3d45c32d4da88.css" integrity="sha256-7CjwnpRvwN93wYf80NDr3lj8pt6O&#43;44WIPPUXDLU2og=" crossorigin="anonymous" media="screen" />

    
    <link rel="stylesheet" href="/scss/highlight/github-dark.min.min.66034289ee9a113219a2c4aae0a8bd2095ab255c832a42efcf5863f10814e7a1.css" />

    
    <script src="/js/highlight.min.min.c607d6febd16934a82eb61d3a896ed9d869f54373cc63ce95864ed5488fe3128.js"></script>
    <script>hljs.highlightAll();</script>

    <script>(()=>{var t=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,e=localStorage.getItem("theme");t&&e===null&&(localStorage.setItem("theme","dark"),document.documentElement.setAttribute("data-dark-mode","")),t&&e==="dark"&&document.documentElement.setAttribute("data-dark-mode",""),e==="dark"&&document.documentElement.setAttribute("data-dark-mode","")})()</script>
    </head>
<body>
      <main class="wrapper"><nav class="navigation">
    <section class="container">
        <a class="navigation-brand" href="/zh">
            HOME
        </a>
        <input type="checkbox" id="menu-toggle" />
        <label class="menu-button float-right" for="menu-toggle">
            <span></span><span></span><span></span>
        </label>
        
        <ul class="navigation-list" id="navigation-list">
            
            
            <li class="navigation-item navigation-menu">
                <a class="navigation-link" href="/zh/blog">文章</a>
            </li>
            
            <li class="navigation-item navigation-menu">
                <a class="navigation-link" href="/zh/tags">分类</a>
            </li>
            
            <li class="navigation-item navigation-menu">
                <a class="navigation-link" href="/zh/archives">历史文章</a>
            </li>
            
            <li class="navigation-item navigation-menu">
                <a class="navigation-link" href="https://umami-blog-pi.vercel.app/share/q7qW5hQ16F8cTkBD/noneback.github.io">网站统计</a>
            </li>
            
            <li class="navigation-item navigation-menu">
                <a class="navigation-link" href="/zh/about/">About</a>
            </li>
            
            

            <li class="navigation-item menu-separator">
                <span>|</span>
            </li>

            
            
            <li class="navigation-item navigation-social">
                <a class="navigation-link" href="https://github.com/noneback"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg></a>
            </li>
            
            

            <li class="navigation-item navigation-dark">
                <button id="mode" type="button" aria-label="toggle user light or dark theme">
                    <span class="toggle-dark"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg></span>
                    <span class="toggle-light"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg></span>
                </button>
            </li>

            
            
            
            
            
            <li class="navigation-item navigation-language">
                <a href="https://noneback.github.io/">EN</a>
            </li>
            
            
            
            
            
            
        </ul>
        
    </section>
</nav>
<div id="content">
<article class="blog-single">
  <header class="blog-title">
    <h1>基于朴素贝叶斯的中文垃圾电子邮件分类</h1>
  </header>

  <p>
  <small>
    2020年5月6日&nbsp;· 1684 字&nbsp;· 4 分钟</small>

  <small>
      
      ·
      
      
      <a href="https://noneback.github.io/zh/tags/ml/">ML</a>
      
    </small>
  
<p>

  <div class="blog-toc">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#训练数据和测试数据">训练数据和测试数据</a></li>
    <li><a href="#数据处理">数据处理</a></li>
    <li><a href="#训练与预测">训练与预测</a></li>
    <li><a href="#结果">结果</a></li>
    <li><a href="#附加">附加</a></li>
    <li><a href="#源码">源码</a></li>
  </ul>
</nav>
  </div>

  <section class="blog-content"><h1 id="基于朴素贝叶斯的中文垃圾电子邮件分类">基于朴素贝叶斯的中文垃圾电子邮件分类</h1>
<h2 id="训练数据和测试数据">训练数据和测试数据</h2>
<p>本次主要使用了<a href="https://github.com/shijing888/BayesSpam">github上的开源数据</a></p>
<h2 id="数据处理">数据处理</h2>
<p>首先使用正则表达式对训练集中的中文邮件的内容进行过滤，去除其中中文之外的其他字符，再将剩下的内容使用<a href="https://github.com/fxsjy/jieba">jieba</a>进行分词，过滤掉中文停用字表中的内容。将垃圾邮件以及正常邮件的处理结果分别存放。</p>
<p>用两个字典spam_voca和normal_voca用于保存不同邮件中不同词语的词频，数据处理完成。</p>
<h2 id="训练与预测">训练与预测</h2>
<p>训练和预测的过程主要使计算$ P(Spam|word_1,word_2,&hellip;,word_n) $的概率，当这个概率大于某个阈值的时候，这个邮件被分类为垃圾邮件。</p>
<blockquote>
<p>根据朴素贝叶斯的条件独立假设，并设先验概率$P(s)=P(s^{&rsquo;})=0.5$,则有：  P(s|w_1,w_2,&hellip;,w_n)=$\frac {P(s,w_1,w_2,&hellip;,w_n)}{P(w_1,w_2,&hellip;,w_n)}$</p>
<p>=$\frac {P(w_1,w_2,&hellip;,w_n|s)P(s)}{P(w_1,w_2,&hellip;,w_n)}$=$\frac {P(w_1,w_2,&hellip;,w_n|s)P(s)}{P(w_1,w_2,&hellip;,w_n|s)\cdot p(s)+P(w_1,w_2,&hellip;,w_n|s^{&rsquo;})\cdot p(s^{&rsquo;})}\qquad\qquad$</p>
<p>因为P(spam)=P(not spam),则有</p>
<p>$\frac {\prod\limits_{j=1}^nP(w_j|s)}{\prod\limits_{j=1}^nP(w_j|s)+\prod\limits_{j=1}^nP(w_j|s^{&rsquo;})}$
再利用贝叶斯$P(w_j|s)=\frac{P(s|w_j)\cdot P(w_j)}{P(s)}$,式子化为
$\frac {\prod\limits_{j=1}^nP(s|w_j)}{\prod\limits_{j=1}^nP(s|w_j)+\prod\limits_{j=1}^nP(s^{&rsquo;}|w_j)}$</p>
</blockquote>
<p>具体流程</p>
<ul>
<li>对测试集中的每一封邮件做同样的处理，并计算得到$P(s|w)$最高的n个词，在计算过程中，若该词只出现在垃圾邮件的词典中，则令$P(w|s^{&rsquo;})=0.01$，反之亦然；若都未出现，则令$P(s|w)=0.4$。PS.这里做的几个假设基于前人做的一些研究工作得出的。</li>
<li>对得到的每封邮件中重要的15个词利用式2计算概率，若概率$&gt;$阈值$\alpha(一般设为0.9)$，则判为垃圾邮件，否则判为正常邮件。</li>
</ul>
<p>具体的代码细节可以参见附加的代码。</p>
<h2 id="结果">结果</h2>
<p>通过调整预测是使用的词汇的数量，针对本次数据集，最佳的结果是</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>选择29个词汇 : <span style="color:#ae81ff">0.9642857142857143</span>
</span></span></code></pre></div><h2 id="附加">附加</h2>
<ul>
<li>
<p>项目结构
├── data
│   ├── 中文停用词表.txt
│   ├── normal
│   ├── spam
│   └── test
├── main.py
├── normal_voca.json
├── <strong>pycache</strong>
│   └── utils.cpython-36.pyc
├── spam_voca.json
└── utils.py</p>
</li>
<li>
<p>具体代码</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># utils.py</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> jieba
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> re
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> json
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> collections <span style="color:#f92672">import</span> defaultdict
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>spam_file_num<span style="color:#f92672">=</span><span style="color:#ae81ff">7775</span> 
</span></span><span style="display:flex;"><span>normal_file_num<span style="color:#f92672">=</span><span style="color:#ae81ff">7063</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#todo 原始邮件数据的预处理</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">获取中文的停用词表
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">【停用词】（https://zh.wikipedia.org/wiki/</span><span style="color:#e6db74">%E</span><span style="color:#e6db74">5</span><span style="color:#e6db74">%81%</span><span style="color:#e6db74">9C</span><span style="color:#e6db74">%E</span><span style="color:#e6db74">7</span><span style="color:#e6db74">%94%</span><span style="color:#e6db74">A8</span><span style="color:#e6db74">%E</span><span style="color:#e6db74">8%AF%8D）
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_stopwords</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> [
</span></span><span style="display:flex;"><span>        i<span style="color:#f92672">.</span>strip() <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> open(<span style="color:#e6db74">&#39;./data/中文停用词表.txt&#39;</span>, encoding<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;gbk&#39;</span>)
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    读取原始文件，进行简单的处理和分词，返回分词列表
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_raw_str_list</span>(path):
</span></span><span style="display:flex;"><span>    stop_list <span style="color:#f92672">=</span> get_stopwords()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">with</span> open(path, encoding<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;gbk&#39;</span>) <span style="color:#66d9ef">as</span> f:
</span></span><span style="display:flex;"><span>        raw_str <span style="color:#f92672">=</span> f<span style="color:#f92672">.</span>read()
</span></span><span style="display:flex;"><span>    pattern <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;[^</span><span style="color:#ae81ff">\u4E00</span><span style="color:#e6db74">-</span><span style="color:#ae81ff">\u9FA5</span><span style="color:#e6db74">]&#39;</span>  <span style="color:#75715e">#中文的unicode编码的范围</span>
</span></span><span style="display:flex;"><span>    regex <span style="color:#f92672">=</span> re<span style="color:#f92672">.</span>compile(pattern)
</span></span><span style="display:flex;"><span>    ret <span style="color:#f92672">=</span> regex<span style="color:#f92672">.</span>findall(raw_str)
</span></span><span style="display:flex;"><span>    handled_str <span style="color:#f92672">=</span> re<span style="color:#f92672">.</span>sub(pattern, <span style="color:#e6db74">&#39;&#39;</span>, raw_str)
</span></span><span style="display:flex;"><span>    str_list <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>        word <span style="color:#66d9ef">for</span> word <span style="color:#f92672">in</span> jieba<span style="color:#f92672">.</span>cut(handled_str) <span style="color:#66d9ef">if</span> word <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> stop_list
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> str_list
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#分词以及统计词频，得到词汇表</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">返回一个字典，记录了分词后的词汇表
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">path:k可以使dir或者file路径，默认为存放文本的dir
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">is_file_path:表示输入路径是不是文件
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_voca</span>(path, is_file_path<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> is_file_path:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> read_voca_from_file(path)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    voca <span style="color:#f92672">=</span> defaultdict(int)
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 获取垃圾邮件列表</span>
</span></span><span style="display:flex;"><span>    file_list <span style="color:#f92672">=</span> [file <span style="color:#66d9ef">for</span> file <span style="color:#f92672">in</span> os<span style="color:#f92672">.</span>listdir(path)]
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#获得词汇表</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> file <span style="color:#f92672">in</span> file_list:  <span style="color:#75715e">#测试用</span>
</span></span><span style="display:flex;"><span>        raw_str_list <span style="color:#f92672">=</span> get_raw_str_list(path <span style="color:#f92672">+</span> str(file))
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> raw_str <span style="color:#f92672">in</span> raw_str_list:
</span></span><span style="display:flex;"><span>            voca[raw_str] <span style="color:#f92672">=</span> voca[raw_str] <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> voca
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    将得到的词汇表保存到json文件中，以便下次读取
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    voca:词汇表字典
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    path:文件的保存路径
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    sort_by_value:是否按value值排序
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">save_voca2json</span>(voca, path, sort_by_value<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,indent_<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> sort_by_value:
</span></span><span style="display:flex;"><span>        sorted_by_value(voca)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">with</span> open(path, <span style="color:#e6db74">&#39;w+&#39;</span>) <span style="color:#66d9ef">as</span> f:
</span></span><span style="display:flex;"><span>        f<span style="color:#f92672">.</span>write(json<span style="color:#f92672">.</span>dumps(voca, ensure_ascii<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>, indent<span style="color:#f92672">=</span>indent_))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">从json文件中读取voca
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">read_voca_from_file</span>(path):
</span></span><span style="display:flex;"><span>    voca <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">with</span> open(path) <span style="color:#66d9ef">as</span> f:
</span></span><span style="display:flex;"><span>        voca <span style="color:#f92672">=</span> json<span style="color:#f92672">.</span>load(f)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> voca
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">将字典基于value排序
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">sorted_by_value</span>(_dict):
</span></span><span style="display:flex;"><span>    _dict <span style="color:#f92672">=</span> dict(sorted(spam_voca<span style="color:#f92672">.</span>items(), key<span style="color:#f92672">=</span><span style="color:#66d9ef">lambda</span> x: x[<span style="color:#ae81ff">1</span>], reverse<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#计算 P(Spam|word)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    计算邮件和邮件分类最相关词语及其 P(spam|word)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    words_size:最终使用词语的数量，用于最后的预测
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_top_words_prob</span>(path,spam_voca,normal_voca,words_size<span style="color:#f92672">=</span><span style="color:#ae81ff">30</span>):
</span></span><span style="display:flex;"><span>    critical_words<span style="color:#f92672">=</span>[]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> word <span style="color:#f92672">in</span> get_raw_str_list(path):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> word <span style="color:#f92672">in</span> spam_voca<span style="color:#f92672">.</span>keys() <span style="color:#f92672">and</span> word <span style="color:#f92672">in</span> normal_voca<span style="color:#f92672">.</span>keys():
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># 如果word在两边都出现</span>
</span></span><span style="display:flex;"><span>            p_w_s<span style="color:#f92672">=</span>spam_voca[word]<span style="color:#f92672">/</span>spam_file_num
</span></span><span style="display:flex;"><span>            p_w_n<span style="color:#f92672">=</span>normal_voca[word]<span style="color:#f92672">/</span>normal_file_num
</span></span><span style="display:flex;"><span>            p_s_w<span style="color:#f92672">=</span>p_w_s<span style="color:#f92672">/</span>(p_w_n<span style="color:#f92672">+</span>p_w_s)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">elif</span> word <span style="color:#f92672">in</span> spam_voca<span style="color:#f92672">.</span>keys() <span style="color:#f92672">and</span> word <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> normal_voca<span style="color:#f92672">.</span>keys():
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># 如果word只在spam出现</span>
</span></span><span style="display:flex;"><span>            p_w_s<span style="color:#f92672">=</span>spam_voca[word]<span style="color:#f92672">/</span>spam_file_num
</span></span><span style="display:flex;"><span>            p_w_n<span style="color:#f92672">=</span><span style="color:#ae81ff">0.01</span>
</span></span><span style="display:flex;"><span>            p_s_w<span style="color:#f92672">=</span>p_w_s<span style="color:#f92672">/</span>(p_w_n<span style="color:#f92672">+</span>p_w_s)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">elif</span> word <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> spam_voca<span style="color:#f92672">.</span>keys() <span style="color:#f92672">and</span> word <span style="color:#f92672">in</span> normal_voca<span style="color:#f92672">.</span>keys():
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># 如果word只在normal出现</span>
</span></span><span style="display:flex;"><span>            p_w_s<span style="color:#f92672">=</span><span style="color:#ae81ff">0.01</span>
</span></span><span style="display:flex;"><span>            p_w_n<span style="color:#f92672">=</span>normal_voca[word]<span style="color:#f92672">/</span>normal_file_num
</span></span><span style="display:flex;"><span>            p_s_w<span style="color:#f92672">=</span>p_w_s<span style="color:#f92672">/</span>(p_w_n<span style="color:#f92672">+</span>p_w_s)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">#如果都不出现</span>
</span></span><span style="display:flex;"><span>            p_s_w<span style="color:#f92672">=</span><span style="color:#ae81ff">0.4</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">#以上设定的数值均是基于前人的研究得到的数据</span>
</span></span><span style="display:flex;"><span>        critical_words<span style="color:#f92672">.</span>append([word,p_s_w])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> dict(sorted(critical_words[:words_size],key<span style="color:#f92672">=</span><span style="color:#66d9ef">lambda</span> x:x[<span style="color:#ae81ff">1</span>],reverse<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    计算贝叶斯概率
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    words_prob：包含词汇以及其P(spam|word)概率的一个字典
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    spam_voca:垃圾邮件词汇表
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    normal_voca:正常邮件词汇表
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">caculate_bayes</span>(words_prob,spam_voca,normal_voca):
</span></span><span style="display:flex;"><span>    p_s_w<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    p_s_nw<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> word,prob <span style="color:#f92672">in</span> words_prob<span style="color:#f92672">.</span>items():
</span></span><span style="display:flex;"><span>        p_s_w<span style="color:#f92672">*=</span>prob
</span></span><span style="display:flex;"><span>        p_s_nw<span style="color:#f92672">*=</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">-</span>prob)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> p_s_w<span style="color:#f92672">/</span>(p_s_w<span style="color:#f92672">+</span>p_s_nw)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">predict</span>(bayes,threshold<span style="color:#f92672">=</span><span style="color:#ae81ff">0.9</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> bayes<span style="color:#f92672">&gt;=</span>threshold    
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    返回文件名和label
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_files_labels</span>(dir_path,is_spam<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>):
</span></span><span style="display:flex;"><span>    raw_files_list<span style="color:#f92672">=</span>os<span style="color:#f92672">.</span>listdir(dir_path)
</span></span><span style="display:flex;"><span>    files_list<span style="color:#f92672">=</span> [dir_path<span style="color:#f92672">+</span>file <span style="color:#66d9ef">for</span> file <span style="color:#f92672">in</span> raw_files_list]
</span></span><span style="display:flex;"><span>    labels<span style="color:#f92672">=</span>[is_spam <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(files_list))]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> files_list,labels
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    预测测试集结果并打印
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    file_list：测试集文件路径集合
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    y:测试集结果标签
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    word_size：预测的指标
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">predict_result</span>(file_list,y,spam_voca,normal_voca,word_size<span style="color:#f92672">=</span><span style="color:#ae81ff">30</span>):
</span></span><span style="display:flex;"><span>    ret<span style="color:#f92672">=</span>[]
</span></span><span style="display:flex;"><span>    right<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> file <span style="color:#f92672">in</span> file_list:
</span></span><span style="display:flex;"><span><span style="color:#75715e">#         raw_strs=get_raw_str_list(str(file))</span>
</span></span><span style="display:flex;"><span>        words_prob<span style="color:#f92672">=</span>get_top_words_prob(file,spam_voca,normal_voca,words_size<span style="color:#f92672">=</span>word_size)
</span></span><span style="display:flex;"><span>        bayes<span style="color:#f92672">=</span>caculate_bayes(words_prob,spam_voca,normal_voca)
</span></span><span style="display:flex;"><span>        ret<span style="color:#f92672">.</span>append(predict(bayes))
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(ret)):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ret[i]<span style="color:#f92672">==</span>y[i]:
</span></span><span style="display:flex;"><span>            right<span style="color:#f92672">+=</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    print(right<span style="color:#f92672">/</span>len(y))
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e">#main.py</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> utils <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__<span style="color:#f92672">==</span><span style="color:#e6db74">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#获取词典并保存，一遍下次读取</span>
</span></span><span style="display:flex;"><span>    spam_voca<span style="color:#f92672">=</span>get_voca(<span style="color:#e6db74">&#39;./spam_voca.json&#39;</span>,is_file_path<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>    normal_voca<span style="color:#f92672">=</span>get_voca(<span style="color:#e6db74">&#39;./normal_voca.json&#39;</span>,is_file_path<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#保存方便下次读取</span>
</span></span><span style="display:flex;"><span>    save_voca2json(spam_voca,<span style="color:#e6db74">&#39;./spam_voca.json&#39;</span>)
</span></span><span style="display:flex;"><span>    save_voca2json(normal_voca,<span style="color:#e6db74">&#39;./snormal_voca.json&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#预处理测试数据</span>
</span></span><span style="display:flex;"><span>    s_x,s_y<span style="color:#f92672">=</span>get_files_labels(<span style="color:#e6db74">&#39;./data/test/spam/&#39;</span>)
</span></span><span style="display:flex;"><span>    n_x,n_y<span style="color:#f92672">=</span>get_files_labels(<span style="color:#e6db74">&#39;./data/test/normal/&#39;</span>,is_spam<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>)
</span></span><span style="display:flex;"><span>    x,y<span style="color:#f92672">=</span>list(s_x<span style="color:#f92672">+</span>n_x),s_y<span style="color:#f92672">+</span>n_y
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#预测结果</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">10</span>,<span style="color:#ae81ff">40</span>):
</span></span><span style="display:flex;"><span>        print(str(i)<span style="color:#f92672">+</span><span style="color:#e6db74">&#39; : &#39;</span>,end<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&#39;</span>)
</span></span><span style="display:flex;"><span>        predict_result(x,y,spam_voca,normal_voca,word_size<span style="color:#f92672">=</span>i)
</span></span></code></pre></div></li>
</ul>
<h2 id="源码">源码</h2>
<p><a href="https://github.com/noneback/Toys/tree/master/Bayes">github</a></p>
</section>

  
  
  <div class="paginator">
    
    <a class="prev" href="https://noneback.github.io/zh/blog/zh/%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84%E6%95%B0%E6%8D%AE%E5%BA%93--%E5%89%8D%E7%AB%AF/">
      <svg class="icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M3.77086 21.1546C11.0491 22.698 21.4339 21.7773 21.4339 16.3608V4.63375C21.4339 3.93962 21.3581 3.30535 21.1917 2.76787M3.77086 21.1546C1.9934 20.7777 0.973585 18.7264 1.08749 16.688C1.2668 13.479 1.15721 9.43135 1.00513 6.21507C0.87809 3.52811 3.12891 1.16316 5.51029 1.25008C9.76594 1.40542 15.377 1.20229 18.7912 1.00542C20.0864 0.930734 20.8406 1.63385 21.1917 2.76787M3.77086 21.1546C4.56586 21.4723 5.49168 21.7879 6.5 22.0658M21.1917 2.76787C23.1097 4.18217 23.13 12.4191 22.9004 16.3608C20.8478 24.0194 12.3061 23.6662 6.5 22.0658M21.1917 2.76787C21.7612 4.51192 22.7203 9.67216 22 16.3608C21.2797 23.0494 11.3665 22.9511 6.5 22.0658M9.94496 9C9.28897 9.61644 7.63215 10.997 6.04814 11.7966C5.98257 11.8297 5.98456 11.9753 6.05061 12.0063C7.05496 12.4779 8.92941 13.9264 9.94496 15M6.44444 11.9667C8.86549 12.0608 14 12 16 11" stroke="currentColor" stroke-linecap="round"/>
      </svg>
      <span>实现简单的SQL数据库--前端</span></a>
    
    
    <a class="next" href="https://noneback.github.io/zh/blog/zh/cpp%E5%B7%A6%E5%80%BC%E5%92%8C%E5%8F%B3%E5%80%BC%E7%9A%84%E5%8C%BA%E5%88%AB/"><span>C&#43;&#43;中左值和右值的区别</span>
      <svg class="icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M3.77086 21.1546C11.0491 22.698 21.4339 21.7773 21.4339 16.3608V4.63375C21.4339 3.93962 21.3581 3.30535 21.1917 2.76787M3.77086 21.1546C1.9934 20.7777 0.973585 18.7264 1.08749 16.688C1.2668 13.479 1.15721 9.43135 1.00513 6.21507C0.87809 3.52811 3.12891 1.16316 5.51029 1.25008C9.76594 1.40542 15.377 1.20229 18.7912 1.00542C20.0864 0.930734 20.8406 1.63385 21.1917 2.76787M3.77086 21.1546C4.56586 21.4723 5.49168 21.7879 6.5 22.0658M21.1917 2.76787C23.1097 4.18217 23.13 12.4191 22.9004 16.3608C20.8478 24.0194 12.3061 23.6662 6.5 22.0658M21.1917 2.76787C21.7612 4.51192 22.7203 9.67216 22 16.3608C21.2797 23.0494 11.3665 22.9511 6.5 22.0658M12.055 9C12.711 9.61644 14.3679 10.997 15.9519 11.7966C16.0174 11.8297 16.0154 11.9753 15.9494 12.0063C14.945 12.4779 13.0706 13.9264 12.055 15M15.5556 11.9667C13.1345 12.0608 8 12 6 11" stroke="currentColor" stroke-linecap="round"/>
      </svg>
    </a>
    
  </div>
  

  


  
  
<div class="comments">
  <script>
      const getTheme = window.localStorage && window.localStorage.getItem("theme");
      let theme = getTheme === 'dark' ? 'dark' : 'light';
      let s = document.createElement('script');
      s.src = 'https://giscus.app/client.js';
      s.setAttribute('data-repo', 'noneback\/noneback.github.io');
      s.setAttribute('data-repo-id', 'MDEwOlJlcG9zaXRvcnkzMTAyNzgwNTc=');
      s.setAttribute('data-category', 'Announcements');
      s.setAttribute('data-category-id', 'DIC_kwDOEn53qc4Cj4-F');
      s.setAttribute('data-mapping', 'pathname');
      s.setAttribute('data-strict', '0');
      s.setAttribute('data-reactions-enabled', '1');
      s.setAttribute('data-emit-metadata', '0');
      s.setAttribute('data-input-position', 'top');
      s.setAttribute('data-theme', theme);
      s.setAttribute('data-lang', 'en');
      s.setAttribute('data-loading', 'lazy');
      s.setAttribute('crossorigin', 'anonymous');
      s.setAttribute('async', '');
      document.querySelector('div.comments').innerHTML = '';
      document.querySelector('div.comments').appendChild(s);
  </script>
</div>

</article>


        </div><footer class="footer">
  <p>&copy; 2024 <a href="https://noneback.github.io/">NoneBack</a>
    Powered by
    <a href="https://gohugo.io/" rel="noopener" target="_blank">Hugo️️</a>
    <a href="https://github.com/guangzhengli/hugo-theme-ladder" rel="noopener" target="_blank">Ladder</a>
️  </p>
</footer>

<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M10.5376 22.7916C11.0152 22.7207 22.5795 21.1781 22.0978 10.4211C22.0536 9.43274 21.9303 8.53367 21.7387 7.71865M10.5376 22.7916C16.876 22.3728 20.0969 19.8899 21.5383 16.9142M10.5376 22.7916C9.7707 22.9055 8.97982 22.8964 8.19743 22.7725M21.7387 7.71865C21.4988 6.69828 21.1518 5.80967 20.7188 5.04257M21.7387 7.71865C22.6022 10.1105 23.0542 13.7848 21.5383 16.9142M20.7188 5.04257C17.1684 -1.24629 7.83127 0.632493 4.27577 5.04257C2.88063 6.77451 -0.0433281 11.1668 1.38159 16.6571C2.27481 20.0988 5.17269 22.2936 8.19743 22.7725M20.7188 5.04257C22.0697 6.9404 24.0299 11.3848 22.3541 15.4153M21.5383 16.9142C21.8737 16.4251 22.1428 15.9235 22.3541 15.4153M8.19743 22.7725C12.1971 23.4683 20.6281 22.971 22.3541 15.4153M14 10.945C13.3836 10.289 12.003 8.63215 11.2034 7.04814C11.1703 6.98257 11.0247 6.98456 10.9937 7.05061C10.5221 8.05496 9.07362 9.92941 8 10.945M11.0333 7.44444C10.9392 9.86549 11 15 12 17" stroke="currentColor" stroke-linecap="round"/>
    </svg>
</a>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };
</script>

<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'Copy';

        function copyingDone() {
            copybutton.innerHTML = 'Copied';
            setTimeout(() => {
                copybutton.innerHTML = 'Copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });
        codeblock.parentNode.appendChild(copybutton);
    });
</script></main>
    </body><script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.6/medium-zoom.min.js" integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S+Yti0U7QtuZvQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <script>
      const images = Array.from(document.querySelectorAll(".blog-content img"));
      images.forEach(img => {
          mediumZoom(img, {
              margin: 10,  
              scrollOffset: 40,  
              container: null,  
              template: null,  
              background: 'rgba(0, 0, 0, 0.5)'
          });
      });
  </script>

  
  <script src="/main.min.6bb26b69159420159c74dc9e097b06a578ed2b68c701466a91a44a9632d851bd0af167a1b30012387b4c512b48ad9ad4d3394e04d77ae38d57e1920fe4ed34fe.js" integrity="sha512-a7JraRWUIBWcdNyeCXsGpXjtK2jHAUZqkaRKljLYUb0K8WehswASOHtMUStIrZrU0zlOBNd6441X4ZIP5O00/g==" crossorigin="anonymous" defer></script></html>
